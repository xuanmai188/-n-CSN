<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Admin Panel</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h4>ğŸ”§ Sá»­a lá»—i Admin Panel</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <strong>Äang khÃ´i phá»¥c admin panel...</strong>
                </div>
                
                <div class="progress mb-3">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
                
                <div id="status"></div>
                
                <div class="mt-3">
                    <button class="btn btn-success" onclick="fixAdmin()">ğŸ”§ Sá»­a Admin</button>
                    <button class="btn btn-primary" onclick="restoreData()">ğŸ“¦ KhÃ´i phá»¥c dá»¯ liá»‡u</button>
                    <a href="admin.html" class="btn btn-warning">ğŸš€ VÃ o Admin</a>
                </div>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="./js/lst-products.js"></script>
    
    <script>
        function updateProgress(percent, message) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('status').innerHTML += '<div class="alert alert-info">' + message + '</div>';
        }

        function fixAdmin() {
            updateProgress(10, 'ğŸ”§ Báº¯t Ä‘áº§u sá»­a admin...');
            
            // Clear any corrupted data
            localStorage.removeItem('preventSampleData');
            updateProgress(20, 'âœ… XÃ³a flag corrupt');
            
            // Restore admin user
            localStorage.setItem('adminUser', JSON.stringify({
                username: 'admin',
                password: 'admin123',
                role: 'admin'
            }));
            updateProgress(30, 'âœ… KhÃ´i phá»¥c admin user');
            
            // Restore categories
            const categories = [
                { id: 1, name: "NgÅ© cá»‘c bá»• dÆ°á»¡ng", value: "Nutritious cereals" },
                { id: 2, name: "CÃ¡c loáº¡i Ä‘áº­u", value: "Pulses" },
                { id: 3, name: "Gia vá»‹ vÃ  nÆ°á»›c cháº¥m", value: "Spices and Condiments" },
                { id: 4, name: "Thá»±c pháº©m chá»©c nÄƒng vÃ  má»¹ pháº©m thiÃªn nhiÃªn", value: "Cooking oils" },
                { id: 5, name: "Gáº¡o vÃ  cÃ¡c sáº£n pháº©m tá»« gáº¡o", value: "Rice" }
            ];
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('websiteCategories', JSON.stringify(categories));
            updateProgress(50, 'âœ… KhÃ´i phá»¥c categories');
            
            // Restore brands
            const brands = [
                { id: 1, name: "Organic Valley", description: "Sáº£n pháº©m há»¯u cÆ¡ cháº¥t lÆ°á»£ng cao" },
                { id: 2, name: "Great Value", description: "ThÆ°Æ¡ng hiá»‡u giÃ¡ trá»‹ tá»‘t" },
                { id: 3, name: "Star Organic", description: "ThÆ°Æ¡ng hiá»‡u chÃ­nh cá»§a trang tráº¡i" }
            ];
            localStorage.setItem('brands', JSON.stringify(brands));
            updateProgress(70, 'âœ… KhÃ´i phá»¥c brands');
            
            // Restore products from default
            try {
                const defaultProducts = refreshProducts();
                if (defaultProducts && defaultProducts.length > 0) {
                    localStorage.setItem('products', JSON.stringify(defaultProducts));
                    localStorage.setItem('adminProducts', JSON.stringify(defaultProducts));
                    updateProgress(90, 'âœ… KhÃ´i phá»¥c ' + defaultProducts.length + ' sáº£n pháº©m');
                } else {
                    updateProgress(90, 'âš ï¸ KhÃ´ng tÃ¬m tháº¥y default products');
                }
            } catch (error) {
                updateProgress(90, 'âŒ Lá»—i khÃ´i phá»¥c products: ' + error.message);
            }
            
            updateProgress(100, 'ğŸ‰ HoÃ n thÃ nh! Admin Ä‘Ã£ Ä‘Æ°á»£c sá»­a.');
            
            setTimeout(() => {
                alert('âœ… Admin panel Ä‘Ã£ Ä‘Æ°á»£c sá»­a thÃ nh cÃ´ng!\n\nHÃ£y vÃ o admin.html Ä‘á»ƒ kiá»ƒm tra.');
            }, 1000);
        }

        function restoreData() {
            updateProgress(10, 'ğŸ“¦ Báº¯t Ä‘áº§u khÃ´i phá»¥c dá»¯ liá»‡u...');
            
            // Sample users
            const users = [
                { id: 1, username: 'admin', password: 'admin123', role: 'admin', name: 'Administrator' },
                { id: 2, username: 'user1', password: '123456', role: 'user', name: 'Nguyá»…n VÄƒn A', address: 'HÃ  Ná»™i', phone: '0123456789' },
                { id: 3, username: 'user2', password: '123456', role: 'user', name: 'Tráº§n Thá»‹ B', address: 'TP.HCM', phone: '0987654321' }
            ];
            localStorage.setItem('users', JSON.stringify(users));
            updateProgress(30, 'âœ… KhÃ´i phá»¥c users');
            
            // Sample orders
            const orders = {
                'user1': [
                    {
                        id: 'HC0001',
                        customerName: 'Nguyá»…n VÄƒn A',
                        customerPhone: '0123456789',
                        customerAddress: 'HÃ  Ná»™i',
                        paymentMethod: 'cod',
                        status: 'completed',
                        date: new Date().toISOString(),
                        items: [
                            { id: 1, title: 'Gáº¡o há»¯u cÆ¡', price: 50000, quantity: 2 },
                            { id: 2, title: 'Äáº­u xanh há»¯u cÆ¡', price: 30000, quantity: 1 }
                        ]
                    }
                ],
                'user2': [
                    {
                        id: 'HC0002',
                        customerName: 'Tráº§n Thá»‹ B',
                        customerPhone: '0987654321',
                        customerAddress: 'TP.HCM',
                        paymentMethod: 'bank',
                        status: 'pending',
                        date: new Date().toISOString(),
                        items: [
                            { id: 3, title: 'Gia vá»‹ há»¯u cÆ¡', price: 25000, quantity: 3 }
                        ]
                    }
                ]
            };
            localStorage.setItem('orders', JSON.stringify(orders));
            updateProgress(60, 'âœ… KhÃ´i phá»¥c orders');
            
            // Product reviews
            const reviews = {
                '1': [
                    { id: 1, username: 'user1', rating: 5, comment: 'Sáº£n pháº©m ráº¥t tá»‘t!', date: new Date().toISOString() }
                ],
                '2': [
                    { id: 2, username: 'user2', rating: 4, comment: 'Cháº¥t lÆ°á»£ng á»•n', date: new Date().toISOString() }
                ]
            };
            localStorage.setItem('productReviews', JSON.stringify(reviews));
            updateProgress(80, 'âœ… KhÃ´i phá»¥c reviews');
            
            updateProgress(100, 'ğŸ‰ HoÃ n thÃ nh! Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c khÃ´i phá»¥c.');
            
            setTimeout(() => {
                alert('âœ… Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c khÃ´i phá»¥c thÃ nh cÃ´ng!\n\n- 3 users (admin, user1, user2)\n- 2 Ä‘Æ¡n hÃ ng\n- Reviews sáº£n pháº©m\n\nHÃ£y vÃ o admin.html Ä‘á»ƒ kiá»ƒm tra.');
            }, 1000);
        }

        // Auto fix on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateProgress(5, 'ğŸš€ Trang Ä‘Ã£ load, sáºµn sÃ ng sá»­a admin...');
            }, 500);
        });
    </script>
</body>
</html>